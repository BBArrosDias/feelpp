#include <mixedpoisson.hpp>

using namespace Feel;

inline
AboutData
makeAbout()
{
    AboutData about( "mixed-poisson-model_@D@D_P@P@" ,
                     "mixed-poisson-model_@D@D_P@P@" ,
                     "0.1",
                     "Mixed-Poisson-Model",
                     AboutData::License_GPL,
                     "Copyright (c) 2016 Feel++ Consortium" );
    about.addAuthor( "Christophe Prud'homme", "developer", "christophe.prudhomme@feelpp.org", "" );
    about.addAuthor( "Romain Hild", "developer", "", "" );
    about.addAuthor( "Daniele Prada", "developer", "", "" );
    return about;
}

int main(int argc, char *argv[])
{
    using namespace Feel;
    Feel::Environment env( _argc=argc,
                           _argv=argv,
                           _about=makeAbout(),
                           _desc=FeelModels::makeMixedPoissonOptions("mixedpoisson"),
                           _desc_lib=FeelModels::makeMixedPoissonLibOptions("mixedpoisson").add(feel_options())
                           );


    typedef FeelModels::MixedPoisson<@D@,@P@> mp_type;

    auto MP = mp_type::New("mixedpoisson");
    MP -> init();
    if ( MP -> isStationary() ) {
        MP->solve();    
	MP->exportResults();
    } else {
        for ( ; !MP->timeStepBase()->isFinished() ; MP->updateTimeStep() ) {
            Feel::cout << "============================================================\n";
            Feel::cout << "time simulation: " << MP->time() << "s \n";
            Feel::cout << "============================================================\n";
            MP->solve();
	    MP->exportResults();
        }
    }

    MP->computeError(); 
 
    return 0;
}
